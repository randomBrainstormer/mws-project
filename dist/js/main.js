let restaurants,neighborhoods,cuisines;var map,markers=[];const observerCallback=(e,t)=>{e.forEach(e=>{const t=e.target;if(t.hasAttribute("data-src")&&t.getBoundingClientRect().top<=window.innerHeight&&t.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(t).display){const t=e.target.getAttribute("data-src");e.target.innerHTML=DBHelper.imageSrcsetForRestaurant(t),e.target.removeAttribute("data-src")}})},observer=new IntersectionObserver(observerCallback,{root:null,rootMargin:"0px",threshold:[0]});document.addEventListener("DOMContentLoaded",e=>{initLocalStorage(),fetchNeighborhoods(),fetchCuisines(),updateRestaurants()}),window.addEventListener("load",e=>{[].slice.call(document.querySelectorAll("picture[data-src]")).forEach(e=>{observer.observe(e)})});const swap_map=()=>{"none"!==document.getElementById("static_map").style.display&&(document.getElementById("static_map").style.display="none");self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),addMarkersToMap()};initLocalStorage=(()=>{DBHelper.setupIndexedDB()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const a=document.createElement("option");a.innerHTML=e,a.value=e,t.append(a)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const a=document.createElement("option");a.innerHTML=e,a.value=e,t.append(a)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),a=e.selectedIndex,n=t.selectedIndex,s=e[a].value,o=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(s,o,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),"object"==typeof google&&"object"==typeof google.maps?addMarkersToMap():fetchImageMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),a=document.createElement("picture");a.className="restaurant-img",a.dataset.src=e.photograph,t.append(a);const n=document.createElement("h2");n.innerHTML=e.name,t.append(n);const s=document.createElement("p");s.innerHTML=e.neighborhood,t.append(s);const o=document.createElement("p");o.innerHTML=e.address,t.append(o);const r=document.createElement("a");return r.innerHTML="View Details",r.href=DBHelper.urlForRestaurant(e),t.append(r),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),fetchImageMap=((e=self.restaurants)=>{const t=e.map(e=>`&markers=${e.latlng.lat},${e.latlng.lng}`);document.querySelector("#map").innerHTML=`\n  <img id="static_map" onclick="swap_map()" alt="Google maps image with restaurants" src="https://maps.googleapis.com/maps/api/staticmap?center=40.722216,-73.987501&zoom=12&size=640x640&maptype=roadmap\n  ${t.join("")}\n  &key=AIzaSyBDWVakzxJSRtpMhMzaX8tt9b2vHc38cpE"></img>\n  `});